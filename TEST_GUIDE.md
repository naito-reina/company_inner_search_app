# RAG関連ドキュメント数変更のテストガイド

## 概要
ベクターストアから取得する関連ドキュメントの数を3から5に変更したことを確認するためのテスト手順です。

## 変更箇所
- `sauce/initialize.py` 154行目: `search_kwargs={"k": 5}`

## テスト方法

### 1. ログファイルによる確認（推奨）

#### 手順
1. アプリケーションを起動
2. チャットで質問を送信（例：「社員の育成方針に関するMTGの議事録」）
3. ログファイルを確認: `logs/application.log`
4. ログ内に `[DEBUG] Retrieved document count: 5` というメッセージが出力されているか確認

#### 確認ポイント
- ログに `Retrieved document count: 5` が表示されていること
- 3件ではなく5件が取得されていること

### 2. 画面表示による確認

#### 「社内文書検索」モードでの確認
1. アプリケーションを起動
2. 「社内文書検索」モードを選択
3. チャットで質問を送信
4. 画面に表示される参照元の数を確認
   - メインドキュメント: 1件
   - サブドキュメント: 最大4件（メインと重複しない場合）
   - **合計で最大5件の参照元が表示されることを確認**

#### 「社内問い合わせ」モードでの確認
1. アプリケーションを起動
2. 「社内問い合わせ」モードを選択
3. チャットで質問を送信
4. 「情報源」セクションに表示される参照元の数を確認
   - **最大5件の参照元が表示されることを確認**
   - 重複除去後の件数が表示されるため、実際の取得数はログで確認

### 3. デバッグ出力による確認（開発用）

#### 手順
1. `sauce/utils.py` の `get_llm_response` 関数にデバッグログが追加されていることを確認
2. アプリケーションを起動
3. チャットで質問を送信
4. コンソールまたはログファイルで以下を確認:
   ```
   [DEBUG] Retrieved document count: 5
   ```

### 4. 実際の動作確認テストケース

#### テストケース1: 複数のドキュメントに分散する質問
**質問例**: 「人事部に関する情報を教えて」
**期待結果**: 
- 複数のドキュメントから情報が取得される
- 参照元が5件まで表示される（該当する場合）

#### テストケース2: 特定のドキュメントに集中する質問
**質問例**: 「社員の育成方針に関するMTGの議事録」
**期待結果**:
- 関連するドキュメントが5件取得される
- 重複除去後も複数の参照元が表示される（該当する場合）

#### テストケース3: 関連ドキュメントが少ない質問
**質問例**: 非常に具体的で限定的な質問
**期待結果**:
- 取得できるドキュメント数が5件未満の場合でも、エラーなく動作する
- 取得できた件数分の参照元が表示される

## 確認チェックリスト

- [ ] ログファイルに `Retrieved document count: 5` が出力されている
- [ ] 「社内文書検索」モードで、複数の参照元が表示される（該当する場合）
- [ ] 「社内問い合わせ」モードで、「情報源」に複数の参照元が表示される（該当する場合）
- [ ] エラーなくアプリケーションが動作する
- [ ] 回答の品質が向上している（より多くの関連情報が参照されている）

## トラブルシューティング

### ログに5件が表示されない場合
1. `sauce/initialize.py` の154行目を確認し、`search_kwargs={"k": 5}` が設定されているか確認
2. アプリケーションを再起動（セッション状態をリセット）
3. ベクターストアに十分なドキュメントが登録されているか確認

### 参照元が5件表示されない場合
- 重複除去処理により、実際の表示件数が5件未満になることがあります
- ログファイルで実際の取得件数を確認してください
- 異なるファイルから情報が取得されている場合、5件まで表示されます

## 注意事項
- デバッグログは本番環境では削除することを推奨します
- テスト後、不要なデバッグ出力は削除してください

